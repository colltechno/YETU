<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YETU - ODT√ú Kamp√ºs Rehberi</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Inter', sans-serif;
        }

        body {
            height: 100vh;
            width: 100vw;
            overflow: hidden;
        }

        /* Harita Konteyneri */
        #map {
            height: 100%;
            width: 100%;
            z-index: 1;
        }

        /* Alt Panel (Bottom Sheet) Stilleri */
        .bottom-sheet {
            position: fixed;
            bottom: -100%; /* Ba≈ülangƒ±√ßta ekran dƒ±≈üƒ±nda */
            left: 0;
            width: 100%;
            height: 70vh; /* Ekranƒ±n %70'ini kaplar */
            background: white;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            box-shadow: 0 -5px 25px rgba(0,0,0,0.2);
            transition: bottom 0.4s cubic-bezier(0.1, 0.7, 0.1, 1);
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }

        .bottom-sheet.active {
            bottom: 0;
        }

        /* Panel Tutacaƒüƒ± (S√ºr√ºkleme hissi i√ßin) */
        .sheet-handle {
            width: 50px;
            height: 5px;
            background-color: #ddd;
            border-radius: 5px;
            margin: 15px auto;
            flex-shrink: 0;
        }

        /* ƒ∞√ßerik Alanƒ± */
        .sheet-content {
            padding: 0 20px 20px 20px;
            overflow-y: auto;
            flex-grow: 1;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            border: none;
            background: #f0f0f0;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
        }

        /* Mekan Detay Stilleri */
        .venue-header {
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }

        .venue-name {
            font-size: 1.5rem;
            color: #333;
        }

        .rating-badge {
            display: inline-block;
            background-color: #27ae60;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        /* Men√º Kartlarƒ± */
        .menu-item {
            display: flex;
            justify-content: space-between;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            background: #fff;
        }

        .item-details h4 {
            margin-bottom: 4px;
            color: #333;
        }

        .item-desc {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 4px;
        }

        .allergen-tag {
            font-size: 0.7rem;
            background: #fff3cd;
            color: #856404;
            padding: 2px 6px;
            border-radius: 4px;
            margin-right: 4px;
        }

        .price-box {
            text-align: right;
            min-width: 80px;
        }

        .current-price {
            font-weight: bold;
            color: #2c3e50;
        }

        .price-change {
            font-size: 0.7rem;
            color: #e74c3c;
            display: block;
            margin-top: 2px;
        }
        
        .price-stable {
            color: #27ae60;
        }

        /* Logo Alanƒ± */
        .logo-area {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 999;
            background: white;
            padding: 10px 20px;
            border-radius: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            font-weight: bold;
            color: #c0392b; /* ODT√ú Kƒ±rmƒ±zƒ±sƒ± tonu */
        }
        /* Y√∂n Okunun Stili */
        .user-heading-arrow {
            transition: transform 0.2s linear; /* Yumu≈üak d√∂nmesi i√ßin */
            z-index: 1000;
        }
        /* Navigasyon Butonu Stili */
        .nav-btn {
            background-color: #2980b9; /* Mavi renk */
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            width: 100%;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px; /* ƒ∞kon ile yazƒ± arasƒ± bo≈üluk */
        }

            .nav-btn:hover {
                background-color: #1f618d;
            }
    </style>
</head>
<body>

    <div class="logo-area">YETU</div>

    <div id="map"></div>

    <div class="bottom-sheet" id="infoPanel">
        <div class="sheet-handle"></div>
        <button class="close-btn" onclick="closePanel()">‚úï</button>
        
        <div class="sheet-content" id="panelContent">
            </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // 1. HARƒ∞TA AYARLARI
        // ODT√ú kamp√ºs koordinatlarƒ±na (yakla≈üƒ±k k√ºt√ºphane/√ßar≈üƒ± civarƒ±) odaklanƒ±yoruz
        const map = L.map('map').setView([39.8917541320506, 32.78581820941704], 16);

        // OpenStreetMap katmanƒ±nƒ± ekle
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);

       // 2. MOCK DATA 
        const venues = [
            {
                id: 1,
                name: "Sunshine Cafe",
                coords: [39.88992749815751, 32.79066032352153], 
                rating: 4.2,
                reviews: 128,
                products: [
                    {
                        name: "Tavuklu Sandvi√ß",
                        price: 85,
                        oldPrice: 70,
                        ingredients: "Baget ekmek, ƒ±zgara tavuk, marul, √∂zel sos",
                        allergens: ["Gluten", "Yumurta"],
                        rating: 4.5,
                        lastUpdate: "3 g√ºn √∂nce"
                    },
                    {
                        name: "Filtre Kahve",
                        price: 45,
                        oldPrice: 45,
                        ingredients: "%100 Arabica √ßekirdek",
                        allergens: [],
                        rating: 4.8,
                        lastUpdate: "1 ay √∂nce"
                    }
                ]
            },
            {
                id: 2,
                name: "√áatƒ± Restoran",
                coords: [39.89280919127174, 32.782262702338535], 
                rating: 4.7,
                reviews: 342,
                products: [
                    {
                        name: "√áatƒ± Burger",
                        price: 180,
                        oldPrice: 150,
                        ingredients: "150gr dana k√∂fte, cheddar, karamelize soƒüan",
                        allergens: ["Gluten", "S√ºt √úr√ºnleri"],
                        rating: 4.9,
                        lastUpdate: "1 hafta √∂nce"
                    },
                    {
                        name: "Mercimek √áorbasƒ±",
                        price: 50,
                        oldPrice: 40,
                        ingredients: "Kƒ±rmƒ±zƒ± mercimek, tereyaƒülƒ± sos",
                        allergens: ["S√ºt √úr√ºnleri"],
                        rating: 4.3,
                        lastUpdate: "2 g√ºn √∂nce"
                    }
                ]
            },
            {
                id: 3,
                name: "19. Yurt Restoranƒ±", 
                coords: [39.885744, 32.777485], 
                rating: 4.7, 
                reviews: 56, 
                products: [
                    {
                        name: "Peperoni Pizza", 
                        price: 235, // G√ºncel fiyat
                        oldPrice: 220, // Eski fiyat (Zam okunu i√ßin)
                        ingredients: "Peperoni, Ka≈üar, Pizza Hamuru",
                        allergens: ["Gluten, S√ºt √ºr√ºn√º"], // Varsa alerjenler
                        rating: 4.2, // √úr√ºn puanƒ±
                        lastUpdate: "3 hafta √∂nce"
                    },
                    {
                        name: "Karƒ±≈üƒ±k Pizza", 
                        price: 240,
                        oldPrice: 240,
                        ingredients: "Mƒ±sƒ±r, Sucuk, Sosis, Ka≈üar, Zeytin, Pizza Hamuru",
                        allergens: ["Gluten, S√ºt √ºr√ºn√º"],
                        rating: 4.7,
                        lastUpdate: "D√ºn"
                    },
                    {
                        name: "Mexican Pizza", 
                        price: 250, // G√ºncel fiyat
                        oldPrice: 250, // Eski fiyat (Zam okunu i√ßin)
                        ingredients: "Sucuk, Acƒ± Sos, Ka≈üar, Pizza Hamuru",
                        allergens: ["Gluten, S√ºt √ºr√ºn√º"], // Varsa alerjenler
                        rating: 4.2, // √úr√ºn puanƒ±
                        lastUpdate: "Bug√ºn"
                    },
                    {
                        name: "Margarita Pizza", 
                        price: 220,
                        oldPrice: 200,
                        ingredients: "Ka≈üar, Pizza Hamuru",
                        allergens: ["Gluten, S√ºt √ºr√ºn√º"],
                        rating: 4.8,
                        lastUpdate: "2 ay √∂nce"
                    },
                    {
                        name: "Barbek√º Pizza", 
                        price: 250, // G√ºncel fiyat
                        oldPrice: 250, // Eski fiyat (Zam okunu i√ßin)
                        ingredients: "Tavuk, Barbek√º Sos, Ka≈üar, Pizza Hamuru",
                        allergens: ["Gluten, S√ºt √ºr√ºn√º"], // Varsa alerjenler
                        rating: 4.1, // √úr√ºn puanƒ±
                        lastUpdate: "Bug√ºn"
                    },
                    {
                        name: "Ton Balƒ±klƒ± Pizza", 
                        price: 265,
                        oldPrice: 250,
                        ingredients: "Ton Balƒ±ƒüƒ±, Ka≈üar, Mƒ±sƒ±r, Zeytin, Pizza Hamuru",
                        allergens: ["Gluten, S√ºt √ºr√ºn√º"],
                        rating: 4.9,
                        lastUpdate: "3 hafta √∂nce"
                    },
                    {
                        name: "√ú√ß Peynirli Pizza", 
                        price: 220, // G√ºncel fiyat
                        oldPrice: 220, // Eski fiyat (Zam okunu i√ßin)
                        ingredients: "Ka≈üar, Mozarella, Tulum Peyniri, Pizza Hamuru",
                        allergens: ["Gluten, S√ºt √ºr√ºn√º"], // Varsa alerjenler
                        rating: 5.0, // √úr√ºn puanƒ±
                        lastUpdate: "Bug√ºn"
                    },
                    {
                        name: "√áƒ±tƒ±r Tenders", 
                        price: 185,
                        oldPrice: 165,
                        ingredients: "Tavuk, Galeta Unu, Yumurta, Baharat",
                        allergens: ["Gluten, Yumurta"],
                        rating: 4.9,
                        lastUpdate: "6 hafta √∂nce"
                    },
                    {
                        name: "Cajun Sepeti", 
                        price: 185, // G√ºncel fiyat
                        oldPrice: 185, // Eski fiyat (Zam okunu i√ßin)
                        ingredients: "Tavuk, Galeta Unu, Yumurta, Baharat",
                        allergens: ["Gluten, Yumurta"], // Varsa alerjenler
                        rating: 3.9, // √úr√ºn puanƒ±
                        lastUpdate: "Bug√ºn"
                    },
                    {
                        name: "Cajun D√ºr√ºm", 
                        price: 155,
                        oldPrice: 155,
                        ingredients: "Tavuk, Galeta Unu, Yumurta, Baharat, Lava≈ü",
                        allergens: ["Gluten, Yumurta"],
                        rating: 4.8,
                        lastUpdate: "D√ºn"
                    },
                    {
                        name: "K√ºlah Patso", 
                        price: 95, // G√ºncel fiyat
                        oldPrice: 90, // Eski fiyat (Zam okunu i√ßin)
                        ingredients: "Patates",
                        allergens: [], // Varsa alerjenler
                        rating: 3.2, // √úr√ºn puanƒ±
                        lastUpdate: "Bug√ºn"
                    },
                    {
                        name: "Crispy Chicken", 
                        price: 180,
                        oldPrice: 180,
                        ingredients: "Tavuk, Galeta Unu, Yumurta, Baharat",
                        allergens: ["Gluten, Yumurta"],
                        rating: 4.4,
                        lastUpdate: "D√ºn"
                    },
                    {
                        name: "Tavuk Tako", 
                        price: 210, // G√ºncel fiyat
                        oldPrice: 195, // Eski fiyat (Zam okunu i√ßin)
                        ingredients: "Tavuk, Patates, Ekmek",
                        allergens: ["Gluten"], // Varsa alerjenler
                        rating: 4.3, // √úr√ºn puanƒ±
                        lastUpdate: "5 g√ºn √∂nce"
                    },
                    {
                        name: "Penne Arabiata", 
                        price: 165,
                        oldPrice: 165,
                        ingredients: "Makarna, Domates, Sarƒ±msak, Peynir",
                        allergens: ["S√ºt √ºr√ºn√º"],
                        rating: 4.6,
                        lastUpdate: "D√ºn"
                    },
                    {
                        name: "Kekikli Tavuk", 
                        price: 185, // G√ºncel fiyat
                        oldPrice: 185, // Eski fiyat (Zam okunu i√ßin)
                        ingredients: "Kekik, Tavuk, Makarna, Salata",
                        allergens: [], // Varsa alerjenler
                        rating: 4.1, // √úr√ºn puanƒ±
                        lastUpdate: "Bug√ºn"
                    },
                    {
                        name: "K√∂ri Soslu Tavuk", 
                        price: 185,
                        oldPrice: 175,
                        ingredients: "K√∂ri Baharatƒ±, Zerde√ßal, Soƒüan, Sarƒ±msak, Tavuk",
                        allergens: ["S√ºt √ºr√ºn√º"],
                        rating: 5.0,
                        lastUpdate: "D√ºn"
                    }
                    // Buraya daha fazla √ºr√ºn ekleyebilirsin...
                ]
            }
        ];
        // 3. FONKSƒ∞YONLAR
        const panel = document.getElementById('infoPanel');
        const contentDiv = document.getElementById('panelContent');

        // Haritaya marker ekleme d√∂ng√ºs√º
        venues.forEach(venue => {
            const marker = L.marker(venue.coords).addTo(map);
            
            // Marker'a tƒ±klandƒ±ƒüƒ±nda √ßalƒ±≈üacak olay
            marker.on('click', () => {
                openPanel(venue);
                // Haritayƒ± hafif√ße yukarƒ± kaydƒ±r ki marker panelin altƒ±nda kalmasƒ±n
                map.panTo([venue.coords[0] - 0.002, venue.coords[1]]);
            });
        });

        function openPanel(venue) {
            // HTML i√ßeriƒüini olu≈ütur
            let productsHtml = venue.products.map(prod => {
                // Fiyat deƒüi≈üim mantƒ±ƒüƒ±
                let priceChangeHtml = '';
                if(prod.price > prod.oldPrice) {
                    priceChangeHtml = `<span class="price-change">‚ñ≤ ${prod.oldPrice}‚Ç∫'den y√ºkseldi (${prod.lastUpdate})</span>`;
                } else {
                    priceChangeHtml = `<span class="price-change price-stable">‚óè Fiyat sabit</span>`;
                }

                // Alerjen mantƒ±ƒüƒ±
                let allergensHtml = prod.allergens.length > 0 
                    ? `<div style="margin-top:5px;">${prod.allergens.map(a => `<span class="allergen-tag">‚ö†Ô∏è ${a}</span>`).join('')}</div>`
                    : '';

                return `
                <div class="menu-item">
                    <div class="item-details">
                        <h4>${prod.name} <span style="font-size:0.8em; color:#f1c40f">‚òÖ ${prod.rating}</span></h4>
                        <p class="item-desc">${prod.ingredients}</p>
                        ${allergensHtml}
                    </div>
                    <div class="price-box">
                        <div class="current-price">${prod.price} ‚Ç∫</div>
                        ${priceChangeHtml}
                    </div>
                </div>`;
            }).join('');

            // Navigasyon Linki Olu≈üturma
            // Google Maps Link Formatƒ±: https://www.google.com/maps/dir/?api=1&destination=ENLEM,BOYLAM
            const navLink = `https://www.google.com/maps/dir/?api=1&destination=${venue.coords[0]},${venue.coords[1]}&travelmode=walking`;

            const html = `
                <div class="venue-header">
                    <h2 class="venue-name">${venue.name}</h2>
                    <div class="rating-badge">${venue.rating} / 5.0 (${venue.reviews} yorum)</div>
                </div>
                
                <button class="nav-btn" onclick="window.open('${navLink}', '_blank')">
                    üìç Yol Tarifi Al (Google Maps)
                </button>
                <h3>Men√º & Fiyatlar</h3>
                <div style="margin-top: 15px;">
                    ${productsHtml}
                </div>
            `;

            contentDiv.innerHTML = html;
            panel.classList.add('active');
        }

            const html = `
                <div class="venue-header">
                    <h2 class="venue-name">${venue.name}</h2>
                    <div class="rating-badge">${venue.rating} / 5.0 (${venue.reviews} yorum)</div>
                </div>
                <h3>Men√º & Fiyatlar</h3>
                <div style="margin-top: 15px;">
                    ${productsHtml}
                </div>
            `;

            contentDiv.innerHTML = html;
            panel.classList.add('active');
        }

        function closePanel() {
            panel.classList.remove('active');
        }

        // Haritada bo≈ü bir yere tƒ±klanƒ±nca paneli kapat
        map.on('click', closePanel);
        // --- KONUM BULMA √ñZELLƒ∞ƒûƒ∞ BA≈ûLANGICI ---

        // 1. Kullanƒ±cƒ±nƒ±n konumunu bulmaya √ßalƒ±≈ü
        // setView: true -> Haritayƒ± bulunan konuma kaydƒ±r
        // maxZoom: 16 -> Bulunca bu seviyeye kadar yakƒ±nla≈ü
        map.locate({ setView: true, maxZoom: 16 });

        // 2. Konum ba≈üarƒ±yla bulunursa bu fonksiyon √ßalƒ±≈üƒ±r
        function onLocationFound(e) {
            var radius = e.accuracy; // GPS hata payƒ± (metre cinsinden)

            // Konumun olduƒüu yere mavi bir daire √ßiz
            L.circle(e.latlng, {
                color: 'blue',       // √áer√ßevenin rengi
                fillColor: '#3388ff', // ƒ∞√ß dolgu rengi
                fillOpacity: 0.15,     // Saydamlƒ±k
                radius: radius        // Hata payƒ± kadar geni≈ülik
            }).addTo(map);

            // Tam merkeze koyu mavi bir nokta koy (Google Maps tarzƒ±)
            L.circleMarker(e.latlng, {
                radius: 8,
                fillColor: "#007bff",
                color: "#fff",
                weight: 2,
                opacity: 1,
                fillOpacity: 1
            }).addTo(map)
                .bindPopup("≈ûu an buradasƒ±nƒ±z").openPopup();
            // --- Y√ñN OKU KODU BA≈ûLANGICI ---

            // 1. Kƒ±rmƒ±zƒ± bir ok ikonu olu≈ütur (SVG formatƒ±nda)
            var arrowIcon = L.divIcon({
                className: 'user-heading-arrow',
                iconSize: [40, 40],
                iconAnchor: [20, 20], // Tam ortasƒ±ndan d√∂ns√ºn diye
                html: `
                    <svg viewBox="0 0 24 24" width="40" height="40" style="transform: rotate(0deg);">
                        <path fill="red" d="M12 2L4.5 20.29L5.21 21L12 18L18.79 21L19.5 20.29L12 2Z" />
                        <path fill="none" stroke="white" stroke-width="2" d="M12 2L4.5 20.29L5.21 21L12 18L18.79 21L19.5 20.29L12 2Z" />
                    </svg>
                `
            });

            // 2. Oku haritaya ekle (Konumun olduƒüu yere)
            var headingMarker = L.marker(e.latlng, { icon: arrowIcon }).addTo(map);

            // 3. Telefonun pusulasƒ±nƒ± dinle
            if (window.DeviceOrientationEvent) {
                window.addEventListener('deviceorientation', function (event) {
                    var heading = null;

                    // iOS (iPhone) i√ßin √∂zel hesaplama
                    if (event.webkitCompassHeading) {
                        heading = event.webkitCompassHeading;
                    }
                    // Android i√ßin hesaplama
                    else if (event.alpha) {
                        heading = 360 - event.alpha;
                    }

                    // Eƒüer y√∂n bilgisi alabildiysek oku d√∂nd√ºr
                    if (heading !== null) {
                        // Leaflet ikonunun i√ßindeki SVG'yi bul ve d√∂nd√ºr
                        var iconElement = headingMarker.getElement();
                        if (iconElement) {
                            var svg = iconElement.querySelector('svg');
                            if (svg) {
                                svg.style.transform = 'rotate(' + heading + 'deg)';
                            }
                        }
                    }
                });
            }
            // --- Y√ñN OKU KODU Bƒ∞Tƒ∞≈ûƒ∞ ---
        }

        // 3. Konum bulunamazsa (izin verilmezse) hata verme
        function onLocationError(e) {
            alert("Konum izni vermediƒüiniz i√ßin yerinizi haritada g√∂steremiyoruz.");
            console.log("Konum alƒ±namadƒ±: " + e.message);
        }

        // Olaylarƒ± haritaya baƒüla
        map.on('locationfound', onLocationFound);
        map.on('locationerror', onLocationError);

        // --- KONUM BULMA √ñZELLƒ∞ƒûƒ∞ Bƒ∞Tƒ∞≈ûƒ∞ ---
    </script>
</body>
</html>